<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="./assets/img/logo.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Christian's Profile - Filler!
  </title>
  <meta content='width=device-wid../packages/daygrid/main.css' rel='stylesheet' />
  <link href='th, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css"
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <!-- CSS Files -->
  <link href="./assets/css/material-kit.css?v=2.0.6" rel="stylesheet" />
  <link href="./assets/css/timetablejs.css" rel="stylesheet" />
  <script src="./assets/js/timetable.js"></script>
  <link href='./assets/fullcalendar/core/main.css' rel='stylesheet' />
  <link href='./assets/fullcalendar/daygrid/main.css' rel='stylesheet' />
  <link href='./assets/fullcalendar/list/main.css' rel='stylesheet' />
  <link href='./assets/fullcalendar/timegrid/main.min.css' rel='stylesheet' />
  <link href='./assets/css/main.css' rel='stylesheet' />
  <!-- JS files -->
  <script src='./assets/fullcalendar/core/locales-all.min.js'></script>
  <script src='./assets/fullcalendar/core/main.js'></script>
  <script src='./assets/fullcalendar/interaction/main.js'></script>
  <script src='./assets/fullcalendar/daygrid/main.js'></script>
  <script src='./assets/fullcalendar/timegrid/main.min.js'></script>
  <script src='./assets/fullcalendar/list/main.js'></script>
  <script src='./assets/fullcalendar/google-calendar/main.js'></script>
</head>

<body class="profile-page sidebar-collapse">
  <nav class="navbar navbar-transparent navbar-color-on-scroll fixed-top navbar-expand-lg" color-on-scroll="100"
    id="sectionsNav">
    <div class="container">
      <div class="navbar-translate">
        <a class="navbar-brand" href="index.html">
          Filler! </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="sr-only">Toggle navigation</span>
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a href="#" class="nav-link" data-toggle="dropdown">
              <i class="material-icons">home</i>Home page
            </a>
          </li>
          <li class="nav-item">
            <a href="index.html" class="nav-link">
              <i class="material-icons">lock_open</i>Logout
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" rel="tooltip" title="" data-placement="bottom" href="https://twitter.com/CreativeTim"
              target="_blank" data-original-title="Follow us on Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" rel="tooltip" title="" data-placement="bottom"
              href="https://www.facebook.com/CreativeTim" target="_blank" data-original-title="Like us on Facebook">
              <i class="fa fa-facebook-square"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" rel="tooltip" title="" data-placement="bottom"
              href="https://www.instagram.com/CreativeTimOfficial" target="_blank"
              data-original-title="Follow us on Instagram">
              <i class="fa fa-instagram"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="page-header header-filter" data-parallax="true"
    style="background-image: url('./assets/img/city-profile.jpg');"></div>
  <div class="main main-raised">
    <div class="profile-content">
      <div class="container">
        <div class="row">
          <div class="col-md-6 ml-auto mr-auto">
            <div class="profile">
              <div class="avatar">
                <img src="./assets/img/faces/christian.jpg" alt="Circle Image"
                  class="img-raised rounded-circle img-fluid">
              </div>
              <div class="name">
                <h3 class="title">John Doe</h3>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-content tab-space">

          <div class="row justify-content-center">
            <h3>Preferences</h3>
          </div>
          <div class="row justify-content-center">
            <div class="dropdown">
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="true">
                Music
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu checkbox-menu allow-focus" aria-labelledby="dropdownMenu1">
                <li><label><input type="checkbox" value="music:rock" /> Rock </label></li>
                <li><label><input type="checkbox" value="music:metal" /> Metal </label></li>
                <li><label><input type="checkbox" value="music:jazz" /> Jazz</label></li>
                <li><label><input type="checkbox" value="music:pop" /> Pop </label> </li>
                <li><label><input type="checkbox" value="music:electro" /> Electro </label> </li>
                <li><label><input type="checkbox" value="music:rap" /> Rap </label></li>
              </ul>
            </div>
            <div class="dropdown">
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="true">
                Conferences
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu checkbox-menu allow-focus" aria-labelledby="dropdownMenu1">
                <li><label><input type="checkbox" value="conference:ai" /> Artificial Intelligence </label></li>
                <li><label><input type="checkbox" value="conference:blockchain" /> Blockchain </label></li>
                <li><label><input type="checkbox" value="conference:climate" /> Climate</label></li>
                <li><label><input type="checkbox" value="conference:architecture" /> Architecture </label> </li>
                <li><label><input type="checkbox" value="conference:microbiology" /> Microbiology </label> </li>
                <li><label><input type="checkbox" value="conference:database" /> Database </label></li>
              </ul>
            </div>
            <div class="dropdown">
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="true">
                Art
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu checkbox-menu allow-focus" aria-labelledby="dropdownMenu1">
                <li><label><input type="checkbox" value="art:contemporary" /> Contemporary </label></li>
                <li><label><input type="checkbox" value="art:modern" /> Modern </label></li>
                <li><label><input type="checkbox" value="art:abstract" /> Abstract</label></li>
                <li><label><input type="checkbox" value="art:renaissance" /> Renaissance </label> </li>
              </ul>
            </div>
          </div>
          <div class="row justify-content-center">
            <button class="fc-button fc-button-primary" onclick="newEvent()">Fill it!</button>
          </div>
          <div id='calendar' style="padding-top: 80px"></div>
        </div>
      </div>
    </div>
  </div>
  </div>
  <footer class="footer footer-default">
    <div class="container">
      <nav class="float-left">
        <ul>
          <li>
            <a href="https://www.creative-tim.com">
              Creative Tim
            </a>
          </li>
          <li>
            <a href="https://creative-tim.com/presentation">
              About Us
            </a>
          </li>
          <li>
            <a href="http://blog.creative-tim.com">
              Blog
            </a>
          </li>
          <li>
            <a href="https://www.creative-tim.com/license">
              Licenses
            </a>
          </li>
        </ul>
      </nav>
      <div class="copyright float-right">
        &copy;
        <script>
          document.write(new Date().getFullYear())
        </script>, made with <i class="material-icons">favorite</i> by
        <a href="https://www.creative-tim.com" target="_blank">Creative Tim</a> for a better web.
      </div>
    </div>
  </footer>
  <!--   Core JS Files   -->
  <script src="./assets/js/core/jquery.min.js" type="text/javascript"></script>
  <script src="./assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="./assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
  <script src="./assets/js/plugins/moment.min.js"></script>
  <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
  <script src="./assets/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <script src="./assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
  <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
  <script src="./assets/js/material-kit.js?v=2.0.6" type="text/javascript"></script>
  <script>
    const COLORS = Object({
      "google": "#3788d8",
      "conference": "#49f83a",
      "art": "#b80b76",
      "music": "#b8500b"
    });
    const CALENDAR_ADDRESS = "k2joi0hlfr9ijj07u6n6lru1gc@group.calendar.google.com";

    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      plugins: ['interaction', 'dayGrid', 'timeGrid', 'list', 'googleCalendar'],
      locale: 'en-us',
      firstDay: 1,
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      eventClick: function (info) {
        var eventObj = info.event;
        if (eventObj.id == "") {
          var new_input = {
            start: eventObj.start,
            end: eventObj.end,
            title: eventObj.title,
            color: COLORS['google'] || "#00FF00"
          }
          calendar.addEvent(new_input, "MyGoogleCalendar");
          eventObj.remove()
          calendar.render()
        }
        info.jsEvent.preventDefault(); // prevents browser from following link in current tab.
      },
      googleCalendarApiKey: "AIzaSyC2y8YnKmvtdaYzRJCCnU7i8BaejiWFhdg",
      defaultDate: new Date(),
      navLinks: true, // can click day/week names to navigate views
      businessHours: true, // display business hours
      editable: true,
      eventSources: [{
        id: "MyGoogleCalendar",
        googleCalendarId: CALENDAR_ADDRESS
      }]
    });
    calendar.render();

    async function newEvent() {
      var preferences = [];
      $('.checkbox-menu input:checked').each(function () {
        let val = $(this).attr('value').split(":");
        preferences.push({
          preferenceType: val[0],
          preference: val[1]
        });
      });
      var current_events = [];
      calendar.getEvents().forEach(function (ev) {
        current_events.push({
          name: ev.title,
          start: ev.start,
          end: ev.end
        })
      })
      let body = {
        preferences: preferences,
        startDate: new Date(),
        endDate: calendar.view.activeEnd,
        schedule: current_events
      };
      console.log(JSON.stringify(body))
      jQuery.ajax({
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        'type': 'POST',
        'url': 'http://f6272c35.ngrok.io/api/create-custom-events',
        'data': JSON.stringify(body),
        'dataType': 'json',
        'success': function (events) {
          if (events.length <= 0) {
            alert("No event matching your desires")
          } else {
            events.forEach(function (ev) {
              console.log("Adding an event:" + JSON.stringify(ev));
              try {
                calendar.addEvent({
                  'start': ev.startDate,
                  'end': ev.endDate,
                  'title': ev.name,
                  'color': COLORS[ev.preferences[0].preferenceCategory.name]
                })
              } catch (e) {
                calendar.addEvent({
                  'start': ev.startDate,
                  'end': ev.endDate,
                  'title': ev.name,
                  'color': "#FF0000"
                })
              }
            });
          }

        },
        'error': function (e) {
          alert("Error connecting to the server, please try again later")
        }
      });
    };
  </script>
  <script type="text/javascript">
    $(".checkbox-menu").on("change", "input[type='checkbox']", function () {
      $(this).closest("li").toggleClass("active", this.checked);
    });
    $(document).on('click', '.allow-focus', function (e) {
      e.stopPropagation();
    });
  </script>

</body>

</html>